<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <title>UNIREXCITY RANDOM PICKER</title>
  <script src="snapshot.js"/></script>
  <link rel="stylesheet" href="style/index.css">
</head>

<body id="body">
  <div class="container">
    <header>
      <img src="https://cdn.shopify.com/s/files/1/0598/5137/4768/files/Frame_1_1_2ed6777f-78af-4d88-924d-422699ed6394_1500x.png?v=1632167701" class="header__image">
    </header>
    <h1>LOTTERY</h1>
    <button data-pick-an-unirex-button class="unirex-button">pick a winner</button>
    <main id="main" class="align-left"></main>
  </div>
</body>


<script>

function selectToken () {
    // array of owners
    let ownersKeys      = Object.keys(snapshot);

    // exclude marketplaces
    let realOwners       = ownersKeys.filter(key => !["3D49QorJyNaL4rcpiynbuS3pRH4Y7EXEM6v6ZGaqfFGK", "GUfCR9mK6azb9vcpsxgXyj7XRPAKJd4KMHTTVvtncGgp", "4pUQS4Jo2dsfWzt3VgHXy3H6RYnEDd11oWPiaM2rdAPw"].includes(key));

    // random owner
    let random            = Math.floor(Math.random() * realOwners.length)
    let selectedOwner = realOwners[random];

    // random token
    let winnerOwner   = snapshot[selectedOwner];
    let randomMint    = Math.floor(Math.random() * winnerOwner.mints.length)
    let NFT = winnerOwner.mints[randomMint];

    return NFT;
}

  let main = document.getElementById("main");
  var index = 1;
  let max_nft_to_select = 10;

  document.querySelector("[data-pick-an-unirex-button]").addEventListener('click', function(e) {
      if (index > max_nft_to_select) {
        document.querySelector("[data-pick-an-unirex-button]").disabled = true
        return;
      }
      let winnerToken = selectToken();
      let p = document.createElement("p");
      p.innerHTML = "winner " + index + " : " + winnerToken + "<br/>URL : https://explorer.solana.com/address/" + winnerToken;
      main.append(p);
      index++;
  });

</script>
